<div class="train-button-container" cdkOverlayOrigin #triggerOverlay="cdkOverlayOrigin">
  <ng-container *ngIf="data.isCurrentExam">
    <div class="current-message-container" *ngIf="(menuOpened$ | async) === false">
      <div class="current-message" [style.color]="data.button.floatingLabelColor">
        {{ data.button.floatingLabel }}
      </div>
      <div class="current-message-arrow-container">
        <div class="current-message-arrow"></div>
      </div>
    </div>
    <div class="spinner-buffer"></div>
    <mat-progress-spinner
      mode="determinate"
      [diameter]="100"
      [value]="data.button.progress"
      [strokeWidth]="8"
      class="exercise-spinner"
      color="primary"
    ></mat-progress-spinner>
  </ng-container>

  <button
    mat-icon-button
    class="exercise-button"
    (click)="openMenu()"
    appIsButtonPressed
    #button="appIsButtonPressed"
    [class.current]="data.isCurrentExam"
    [class.button-pressed]="button.isPressed$ | async"
    [style.left]="'calc(50% + ' + data.button.offsetX + 'px)'"
    [style.background-color]="data.button.backgroundColor"
    [style.box-shadow]="(button.isPressed$ | async) ? '' : data.button.boxShadow"
  >
    <mat-icon [svgIcon]="data.button.icon"></mat-icon>
  </button>
</div>

<ng-template
  contextMenu
  let-isCurrentExam="isCurrentExam"
  let-buttonData="button"
  let-contextMenuData="contextMenu"
>
  <div
    class="context-menu"
    appStopClickPropagation
    [class.activated]="isCurrentExam"
    [style.background-color]="contextMenuData?.backgroundColor"
    [@openClose]="(menuOpened$ | async) ? 'open' : 'closed'"
  >
    <div class="menu-arrow-container top" [style.margin-left.px]="buttonData?.offsetX">
      <div
        class="menu-arrow"
        [style.background-color]="contextMenuData?.backgroundColor"
        [style.border-color]="contextMenuData?.backgroundColor"
      ></div>
    </div>
    <h1 class="menu-title">{{ contextMenuData?.title }}</h1>
    <p class="menu-description">{{ contextMenuData?.description }}</p>
    <button
      class="context-button-action"
      mat-raised-button
      [disabled]="contextMenuData?.disabled"
      [style.color]="contextMenuData?.buttonColor"
    >
      {{ contextMenuData?.buttonLabel }}
    </button>
    <div class="menu-arrow-container bottom" [style.margin-left.px]="buttonData?.offsetX">
      <div
        class="menu-arrow"
        [style.background-color]="contextMenuData?.backgroundColor"
        [style.border-color]="contextMenuData?.backgroundColor"
      ></div>
    </div>
  </div>
</ng-template>
